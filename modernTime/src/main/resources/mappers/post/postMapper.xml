<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.care.moderntime.post.repository.IPostDAO">

   <insert id="writeProc" useGeneratedKeys="true" keyProperty="id" parameterType="com.care.moderntime.post.dto.PostDTO">
      INSERT INTO post (`user_id`, `title`, `content`, `is_anonym`, `create_date`, `like_count`, `board_id`, `scrap_count`) VALUES(#{user_id}, #{title}, #{content}, #{is_anonym}, #{create_date}, #{like_count}, #{board_id}, #{scrap_count})
   </insert>
   
   <select id="listProc" resultType="com.care.moderntime.post.dto.PostDTO">
		SELECT * FROM post ORDER BY id DESC
	</select>
	
	<select id="viewProc" resultType="com.care.moderntime.post.dto.PostDTO" parameterType="int">
		SELECT * FROM post WHERE id=#{id}
	</select>
	
	<update id="modifyProc" parameterType="com.care.moderntime.post.dto.PostDTO" >
		UPDATE post SET title=#{title}, content=#{content}, is_anonym=#{is_anonym} WHERE id=#{id}
	</update>
	
	<delete id="deleteProc" parameterType="int">
		DELETE FROM post WHERE id=#{id}
	</delete>
	
	<select id="searchProc" resultType="com.care.moderntime.post.dto.PostDTO">
		SELECT * FROM post
		<choose>
			<!-- <when test="sel == '3'">WHERE hashtag LIKE '%'||#{search}||'%'</when> -->
			<when test="sel == '2'">WHERE title LIKE "%",#{search},"%"</when>
			<when test="sel == '1'">WHERE content LIKE "%",#{search},"%"</when>
		</choose>
		 ORDER BY id DESC 
	</select>
	
	<!-- 공감 -->
	<update id="likeProc" parameterType="com.care.moderntime.post.dto.PostDTO" >
		UPDATE post SET like_count=#{like_count} WHERE id=#{id}
	</update>
	
	<insert id="insertLike" parameterType="com.care.moderntime.post.dto.PostLikeDTO">
      INSERT INTO user_post_like VALUES(#{user_id}, #{post_id})
   </insert>
   
   <select id="countLike" parameterType="com.care.moderntime.post.dto.PostLikeDTO" resultType="int">
		SELECT count(*) FROM user_post_like WHERE user_id=#{user_id} AND post_id=#{post_id}
	</select>
	<!-- 공감 카운트 -->
	<select id="tableCountLike" parameterType="com.care.moderntime.post.dto.PostLikeDTO" resultType="int">
		SELECT count(*) FROM user_post_like WHERE post_id=#{post_id}
	</select>
	
	<!-- 스크랩 -->
	<update id="scrapProc" parameterType="com.care.moderntime.post.dto.PostDTO" >
		UPDATE post SET scrap_count=#{scrap_count} WHERE id=#{id}
	</update>
	
	<insert id="insertScrap" parameterType="com.care.moderntime.post.dto.PostLikeDTO">
      INSERT INTO user_scrap VALUES(#{user_id}, #{post_id})
   </insert>
   
   <select id="countScrap" parameterType="com.care.moderntime.post.dto.PostLikeDTO" resultType="int">
		SELECT count(*) FROM user_scrap WHERE user_id=#{user_id} AND post_id=#{post_id}
	</select>
	<!-- 스크랩 카운트 -->
	<select id="tableCountScrap" parameterType="com.care.moderntime.post.dto.PostLikeDTO" resultType="int">
		SELECT count(*) FROM user_scrap WHERE post_id=#{post_id}
	</select>
	
   
   
</mapper>
